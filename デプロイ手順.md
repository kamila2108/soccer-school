# デプロイ手順

このドキュメントでは、サッカー教室ホームページをVercelにデプロイする手順を初心者向けに詳しく説明します。

## 📋 デプロイ前の準備

### 必要なもの
- **GitHubアカウント**（無料）- コードを保存するために必要です
- **Vercelアカウント**（無料）- アプリケーションを公開するために必要です
- **Supabaseアカウント**（無料）- データベースと認証に使用します

---

## 🚀 ステップ1: GitHubにコードをアップロード

### 1-1. GitHubリポジトリを作成

1. [GitHub](https://github.com/) にアクセスしてログインします
2. 右上の「+」ボタンをクリック → 「New repository」を選択
3. リポジトリ名を入力（例: `soccer-school`）
4. 「Public」または「Private」を選択（どちらでもOK）
5. 「Create repository」をクリック

### 1-2. コードをGitHubにプッシュ

**Windowsの場合（PowerShellまたはコマンドプロンプト）:**

1. プロジェクトのフォルダを開きます（例: `C:\Users\tokam\Downloads\soccer`）

2. 以下のコマンドを順番に実行します：

```bash
# Gitリポジトリを初期化
git init

# すべてのファイルを追加
git add .

# コミット（変更を保存）
git commit -m "Initial commit"

# ブランチ名をmainに変更
git branch -M main

# GitHubリポジトリと接続（あなたのリポジトリURLに置き換えてください）
git remote add origin https://github.com/あなたのユーザー名/リポジトリ名.git

# GitHubにアップロード
git push -u origin main
```

**注意**: 
- `あなたのユーザー名` と `リポジトリ名` は、ステップ1-1で作成したリポジトリの情報に置き換えてください
- 初回はGitHubの認証が求められる場合があります。その場合は、GitHubのユーザー名とパスワード（またはPersonal Access Token）を入力してください

---

## 🎨 ステップ2: Vercelアカウントの作成とログイン

1. [Vercel](https://vercel.com/) にアクセスします
2. 「Sign Up」をクリック
3. 「Continue with GitHub」を選択して、GitHubアカウントでログインします
4. 必要に応じて、VercelがGitHubリポジトリにアクセスする権限を許可します

---

## 📦 ステップ3: Vercelでプロジェクトをインポート

### 3-1. プロジェクトを追加

1. Vercelのダッシュボードで「Add New...」→「Project」をクリック
2. 先ほど作成したGitHubリポジトリを選択します
3. 「Import」をクリック

### 3-2. プロジェクト設定

Vercelが自動的にNext.jsを検出しますが、以下の設定を確認・変更してください：

1. **Framework Preset**: `Next.js` が選択されていることを確認
2. **Root Directory**: `frontend` に変更します
   - 「Edit」をクリック
   - 「Root Directory」に `frontend` と入力
   - 「Continue」をクリック

3. **Build and Output Settings**:
   - Build Command: `npm run build`（デフォルトのまま）
   - Output Directory: **空欄のまま**（Next.jsの場合は自動で検出されます）
   - Install Command: `npm install`（デフォルトのまま）

**⚠️ 重要**: Output Directoryは**空欄のまま**にしてください。Next.jsの場合、Vercelが自動的に正しい出力ディレクトリを検出します。

---

## 🔐 ステップ4: 環境変数の設定

### 4-1. 必要な環境変数

Vercelのプロジェクト設定画面で、「Environment Variables」セクションに以下の環境変数を追加します。

### 4-2. Supabaseの環境変数

**SupabaseのAPIキーを取得する方法:**

1. [Supabase Dashboard](https://supabase.com/dashboard) にアクセス
2. プロジェクトを選択
3. 左側のメニューから「Settings」→「API」をクリック
4. 以下の情報をコピーします：
   - **Project URL**（例: `https://xxxxxxxxxxxxx.supabase.co`）
   - **anon public key**（`eyJ...` で始まる長い文字列）

**Vercelに追加する環境変数:**

| 変数名 | 値 | 説明 |
|--------|-----|------|
| `NEXT_PUBLIC_SUPABASE_URL` | SupabaseのProject URL | SupabaseプロジェクトのURL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabaseのanon public key | Supabaseの公開キー |

### 4-3. NextAuthの環境変数

**NEXTAUTH_SECRETの生成方法:**

1. ターミナル（PowerShell）を開きます
2. 以下のコマンドを実行します：

```bash
# Windows PowerShellの場合
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString() + [System.Guid]::NewGuid().ToString()))
```

または、オンラインツール（https://generate-secret.vercel.app/32）を使用してランダムな文字列を生成することもできます。

**Vercelに追加する環境変数:**

| 変数名 | 値 | 説明 |
|--------|-----|------|
| `NEXTAUTH_SECRET` | 生成したランダムな文字列 | NextAuthの秘密鍵（32文字以上推奨） |
| `NEXTAUTH_URL` | 後で設定（デプロイ後に取得したURL） | アプリケーションのURL |

**注意**: `NEXTAUTH_URL` は、ステップ5でデプロイが完了してURLが確定した後に設定します。

### 4-4. LINEログインの環境変数（オプション）

LINEログイン機能を使用している場合：

| 変数名 | 値 | 説明 |
|--------|-----|------|
| `LINE_CHANNEL_ID` | LINE Developersで取得したChannel ID | LINEログインのチャネルID |
| `LINE_CHANNEL_SECRET` | LINE Developersで取得したChannel Secret | LINEログインのチャネルシークレット |

**LINE Developersでの取得方法:**

1. [LINE Developers](https://developers.line.biz/) にアクセス
2. プロバイダーとチャネルを作成
3. チャネルの「Basic settings」から「Channel ID」と「Channel Secret」をコピー

### 4-5. 環境変数の追加手順

1. Vercelのプロジェクト設定画面で、「Environment Variables」セクションを開く
2. 「Key」に変数名、「Value」に値を入力
3. 「Environment」で適用環境を選択（通常は「Production」「Preview」「Development」すべてにチェック）
4. 「Add」をクリック
5. すべての環境変数を追加したら、「Save」をクリック

---

## 🚀 ステップ5: デプロイの実行

### 5-1. デプロイを開始

1. 環境変数の設定が完了したら、「Deploy」ボタンをクリック
2. デプロイが開始されます（通常、2〜5分程度かかります）
3. デプロイ中は、ログが表示されます。エラーがないか確認してください

### 5-2. デプロイ完了後の確認

1. デプロイが完了すると、以下のようなURLが表示されます：
   - `https://your-project-name.vercel.app`
2. このURLをクリックして、アプリケーションが正常に表示されるか確認します

### 5-3. NEXTAUTH_URLの更新

1. デプロイが完了してURLが確定したら、Vercelのダッシュボードに戻ります
2. 「Settings」→「Environment Variables」を開く
3. `NEXTAUTH_URL` を探して、「Edit」をクリック
4. 値を `https://your-project-name.vercel.app` に更新（実際のURLに置き換え）
5. 「Save」をクリック
6. 再度デプロイを実行します（「Deployments」タブから最新のデプロイを選択し、「Redeploy」をクリック）

---

## ✅ ステップ6: 動作確認

### 6-1. 基本的な動作確認

1. デプロイされたURLにアクセスします
2. ページが正常に表示されることを確認します
3. 各ページ（ホーム、About、Contact、Loginなど）にアクセスして、エラーがないか確認します

### 6-2. 認証機能の確認（LINEログインを使用している場合）

1. ログインページにアクセス
2. LINEログインボタンをクリック
3. LINE認証が正常に動作することを確認

### 6-3. データベース接続の確認

1. Supabase Dashboardにアクセス
2. 「Table Editor」で、データが正常に保存されているか確認（ログイン後など）

---

## 🔄 ステップ7: 今後の更新方法

### コードを更新した場合

1. ローカルでコードを変更します
2. 変更をGitHubにプッシュします：

```bash
git add .
git commit -m "更新内容の説明"
git push
```

3. Vercelが自動的に変更を検出して、再デプロイを開始します
4. 数分後、新しいバージョンが公開されます

**注意**: Vercelは、GitHubの `main` ブランチ（または `master` ブランチ）にプッシュされると自動的にデプロイします。

---

## 🐛 トラブルシューティング

### エラー: "Build failed"

**原因**: ビルドエラーが発生しています

**解決方法**:
1. Vercelの「Deployments」タブで、失敗したデプロイをクリック
2. 「Build Logs」を確認して、エラーメッセージを読みます
3. よくある原因：
   - 環境変数が設定されていない
   - 依存関係のインストールエラー
   - TypeScriptの型エラー

### エラー: "Environment variable not found"

**原因**: 必要な環境変数が設定されていません

**解決方法**:
1. Vercelの「Settings」→「Environment Variables」を確認
2. 必要な環境変数がすべて追加されているか確認
3. 特に `NEXT_PUBLIC_` で始まる変数は、ブラウザ側で使用されるため、必ず設定してください

### エラー: "Cannot connect to Supabase"

**原因**: Supabaseの接続情報が間違っています

**解決方法**:
1. Supabase Dashboardで、Project URLとAPI Keyが正しいか確認
2. Vercelの環境変数 `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が正しく設定されているか確認
3. Supabaseプロジェクトがアクティブ（停止していない）か確認

### ページが表示されない、またはエラーが表示される

**原因**: アプリケーションの実行時エラー

**解決方法**:
1. ブラウザの開発者ツール（F12キー）を開く
2. 「Console」タブでエラーメッセージを確認
3. Vercelの「Deployments」→「Function Logs」でサーバー側のエラーを確認
4. エラーメッセージに基づいて、コードや環境変数を修正

### エラー: "404: NOT_FOUND"

**原因**: ページが見つからないエラーです。主な原因は以下の通りです：

1. **Root Directoryが正しく設定されていない**
2. **Output Directoryの設定が間違っている**
3. **ビルドが失敗している**
4. **環境変数が不足している**

**解決方法（ステップバイステップ）:**

#### ステップ1: Root Directoryの確認

1. Vercelのダッシュボードで、プロジェクトを選択
2. 「Settings」タブをクリック
3. 「General」セクションの「Root Directory」を確認
4. **`frontend`** と設定されていることを確認
5. 設定されていない場合は、`frontend` と入力して「Save」をクリック

#### ステップ2: Build and Output Settingsの確認

1. 「Settings」タブの「General」セクションを開く
2. 「Build and Output Settings」を確認
3. 以下の設定を確認・修正します：

   - **Build Command**: `npm run build`
   - **Output Directory**: **空欄のまま**（重要！）
   - **Install Command**: `npm install`

4. **Output Directoryが `.next` などに設定されている場合は、空欄に変更してください**
5. 「Save」をクリック

#### ステップ3: ビルドログの確認

1. 「Deployments」タブを開く
2. 最新のデプロイをクリック
3. 「Build Logs」を確認
4. エラーメッセージがないか確認

**よくあるビルドエラー:**
- `Cannot find module` → 依存関係がインストールされていない
- `Type error` → TypeScriptの型エラー
- `Environment variable` → 環境変数が不足している

#### ステップ4: 環境変数の確認

1. 「Settings」→「Environment Variables」を開く
2. 以下の環境変数がすべて設定されているか確認：

   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `NEXTAUTH_SECRET`
   - `NEXTAUTH_URL`（デプロイ後のURLに設定）

3. 不足している環境変数があれば追加
4. すべての環境変数が「Production」「Preview」「Development」すべてに適用されているか確認

#### ステップ5: 再デプロイ

1. 設定を変更した後、必ず再デプロイを実行します
2. 「Deployments」タブを開く
3. 最新のデプロイの右側にある「...」（三点メニュー）をクリック
4. 「Redeploy」を選択
5. 「Use existing Build Cache」のチェックを**外す**（重要！）
6. 「Redeploy」をクリック
7. デプロイが完了するまで待ちます（2〜5分程度）

#### ステップ6: 動作確認

1. デプロイが完了したら、URLにアクセス
2. まだ404エラーが表示される場合は、以下を確認：

   - ブラウザのキャッシュをクリア（Ctrl + Shift + Delete）
   - シークレットモード（プライベートモード）でアクセス
   - 別のブラウザでアクセス

#### それでも解決しない場合

1. **ローカルでビルドを確認**:
   ```bash
   cd frontend
   npm install
   npm run build
   ```
   ローカルでビルドが成功することを確認してください。

2. **Vercelのログを詳しく確認**:
   - 「Deployments」→ 該当デプロイ → 「Function Logs」
   - エラーメッセージをコピーして、問題を特定

3. **GitHubリポジトリの確認**:
   - すべてのファイルがGitHubにプッシュされているか確認
   - `.gitignore` で必要なファイルが除外されていないか確認

### デプロイが完了しない

**原因**: ビルドに時間がかかっている、またはエラーが発生している

**解決方法**:
1. Vercelの「Deployments」タブで、デプロイの状態を確認
2. 「Building...」と表示されている場合は、しばらく待ちます（最大10分程度）
3. 長時間「Building...」のままの場合は、デプロイをキャンセルして再試行

---

## 📝 デプロイ前チェックリスト

デプロイ前に以下を確認してください：

- [ ] GitHubリポジトリが作成され、コードがアップロードされている
- [ ] Vercelアカウントが作成されている
- [ ] Vercelでプロジェクトがインポートされている
- [ ] Root Directoryが `frontend` に設定されている
- [ ] すべての環境変数が設定されている：
  - [ ] `NEXT_PUBLIC_SUPABASE_URL`
  - [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - [ ] `NEXTAUTH_SECRET`
  - [ ] `NEXTAUTH_URL`（デプロイ後に設定）
  - [ ] `LINE_CHANNEL_ID`（LINEログインを使用する場合）
  - [ ] `LINE_CHANNEL_SECRET`（LINEログインを使用する場合）
- [ ] ローカルで `npm run build` が成功することを確認
- [ ] Supabaseプロジェクトが作成され、アクティブであることを確認

---

## 💡 補足情報

### Vercelの無料プランの制限

- **月間100GBの帯域幅**: 通常の個人サイトや小規模サイトでは十分です
- **無制限のデプロイ**: 何度でもデプロイできます
- **自動HTTPS**: 無料でSSL証明書が提供されます

### カスタムドメインの設定（オプション）

独自のドメイン（例: `www.yoursite.com`）を使用したい場合：

1. Vercelの「Settings」→「Domains」を開く
2. ドメイン名を入力して「Add」をクリック
3. 表示されるDNS設定を、ドメインのDNS設定に追加します
4. 数時間〜24時間以内に反映されます

### プレビューデプロイ

Vercelは、GitHubのプルリクエスト（PR）を作成すると、自動的にプレビュー環境をデプロイします。これにより、本番環境に影響を与えずに変更をテストできます。

---

## 🆘 サポート

問題が発生した場合は、以下のログを確認してください：

- **Vercel**: 「Deployments」タブ → 該当デプロイ → 「Build Logs」または「Function Logs」
- **ブラウザ**: 開発者ツール（F12キー）→ 「Console」タブ

また、Vercelの公式ドキュメントも参考にしてください：
- [Vercel Documentation](https://vercel.com/docs)

---

**デプロイ完了後、本番環境でアプリケーションが正常に動作することを確認してください！** 🎉
