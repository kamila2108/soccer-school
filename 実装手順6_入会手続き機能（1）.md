## 入会手続き機能（1） 実装手順（初心者向け）

---

## 📚 このガイドについて

このガイドは、**2/12（木）：第1週の振り返り＋入会手続き機能（1）** のうち、  
特に以下の内容を、**プログラミング初心者の方でも迷わず進められるように** 解説したものです。

- 第1週（〜2/11）の簡単な振り返り・調整  
- 入会申込みフォームの画面づくり  
  - 氏名・フリガナ・学年・連絡先などのフォーム項目  
  - フォームバリデーション（必須チェック・形式チェックの基本）  
  - 入力内容を確認する「確認画面」（この日は画面だけ・保存処理はまだ）  

**所要時間の目安**: 約4時間（初めての場合・ゆっくり進める想定）

---

## 📖 用語集（最初に読んでおくと理解が深まります）

### フォーム・入力に関する用語

- **フォーム**: ユーザーが情報を入力するためのまとまりのこと。例：入会申込みフォーム、問い合わせフォーム。
- **入力項目（フィールド）**: 氏名、メールアドレス、電話番号など、フォームの中の1つ1つの入力欄。
- **必須項目**: 必ず入力してもらいたい項目。未入力の場合はエラーとして扱う。
- **バリデーション（validation）**: 入力された値が正しいかどうかをチェックすること。  
  例：「必須チェック」「メールアドレス形式チェック」「文字数チェック」など。
- **エラーメッセージ**: 入力が不正なときにユーザーに表示するメッセージ。  
  例：「氏名は必須です」「メールアドレスの形式が正しくありません」など。

### React / Next.js に関する用語

- **状態（state）**: フォームの入力値など、その時々で変化するデータのこと。  
- **`useState` フック**: React で状態を管理するための機能。入力フォームの値やエラー文を保存しておくために使う。
- **ページコンポーネント**: `frontend/app/○○/page.tsx` に配置される、1ページ分の画面を表すコンポーネント。
- **ルーティング**: URL とページコンポーネントを結びつける仕組み。  
  例：`frontend/app/entry/page.tsx` → `/entry` というURLでアクセスできる。

### 入会手続きに関する用語

- **入会申込みフォーム**: 保護者や本人が「入会したいです」と申請するためのフォーム。
- **確認画面**: 入力内容を最終確認してもらう画面。この段階では、まだデータベース保存は行わず「表示だけ」でOK。

---

## 📋 今日（2/12）の作業内容

開発スケジュールの  
**「2/12（木）：第1週の振り返り＋入会手続き機能（1）」** を完了するためのステップバイステップガイドです。

### 🎯 目標

1. 第1週の振り返りとして、**バグ・気になる点を洗い出し、軽微な修正を行う**  
2. 会員向けに表示する予定の **入会申込みフォームページ（/entry）** を作成する  
3. 氏名・フリガナ・学年・連絡先などの入力フォームを作る（見た目＋入力取得）  
4. 入力漏れなどを防ぐための **簡単なバリデーション（必須チェック＋形式チェック）** を実装する  
5. 入力内容を1画面で確認できる **簡易的な確認画面** を同じページ内で表示できるようにする  
   （この日は「確認画面」まで。**データベース保存や完了画面は 2/13 以降の作業**）

---

## ✅ ステップ1: 第1週（〜2/11）の振り返り・調整

※ここはコードではなく「作業メモ」のイメージです。  
ざっくり20〜30分ほど時間をとって、次のような内容を簡単に整理します。

1. **進捗確認**
   - `開発スケジュール.md` を開き、2/6〜2/11 の項目を1つずつ見直す
   - 「実装手順3」「実装手順4」「実装手順5（共通機能・UI基盤）」のファイルをざっと眺めて、やり残しがないかチェック
2. **簡単なバグ修正**
   - 画面を一通り触ってみて、「文言の誤字」「余白が少し気になる」など、**5〜10分で直せそうなところだけ** 直す
   - 大きめの修正が必要な箇所は、すぐには直さず「メモしておく」に留める
3. **次週のタスク整理**
   - 気になった点・やり残しは `実装手順_TODO.md` や個人メモに箇条書きで書いておく

**現在の状態**: ✅ 第1週の状況をざっくり把握し、今日やるべきこと（入会フォーム）に集中できる状態になった

---

## ✅ ステップ2: 入会申込みページの準備

このステップでは、**入会申込みフォーム用のページ（/entry）** の土台を作ります。

### 2-1. ページファイルの作成

1. VSCode でプロジェクトを開く  
2. 左のエクスプローラーから `frontend/app` フォルダを探す  
3. `app` フォルダを右クリック → 「新しいフォルダー」 → 名前を `entry` にする  
4. `entry` フォルダを右クリック → 「新しいファイル」 → `page.tsx` を作成

### 2-2. ベースとなるページコンポーネントの作成

`frontend/app/entry/page.tsx` に、まずは **レイアウトだけ** を書きます：

```tsx
export default function EntryPage() {
  return (
    <div className="container mx-auto px-4 py-16">
      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-8 space-y-6">
        <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
          入会申込みフォーム
        </h1>
        <p className="text-gray-600">
          必要事項をご入力のうえ、「確認へ進む」ボタンを押してください。
        </p>

        {/* この下にフォームを追加していきます */}
      </div>
    </div>
  )
}
```

**ポイント**:

- `container mx-auto px-4 py-16` … 既存ページと同じように中央揃え＋余白をつける
- `max-w-3xl mx-auto` … 横幅をほどよく制限して、読みやすくする

**現在の状態**: ✅ `/entry` にアクセスすると、入会申込みページのタイトルと説明文が表示される

---

## ✅ ステップ3: 入力フォーム項目（氏名・フリガナ・学年・連絡先など）の作成

### 3-1. 共通コンポーネントの確認

すでに `共通機能・UI基盤` のステップで、以下のコンポーネントが作られています：

- `frontend/components/Button.tsx` … 共通ボタンコンポーネント
- `frontend/components/Input.tsx` … ラベル付きの共通入力コンポーネント

これらを入会フォームでも再利用します。

### 3-2. 入会フォームの全体像

フォームでは、次のような項目を想定します（必要に応じて調整OKです）：

- お子さまの氏名（必須）
- お子さまのフリガナ（必須）
- 学年（必須・プルダウン）
- 保護者氏名（任意 or 必須）
- メールアドレス（必須）
- 電話番号（必須）
- その他・ご質問など（任意・テキストエリア）

### 3-3. フォームの骨組みを作る

まずは **見た目と入力欄だけ** 用意します（バリデーションは次のステップで追加）  
`frontend/app/entry/page.tsx` を、次のように更新します：

```tsx
'use client'

import { useState } from 'react'
import Input from '@/components/Input'
import Button from '@/components/Button'

type FormValues = {
  childName: string
  childFurigana: string
  grade: string
  parentName: string
  email: string
  phone: string
  note: string
}

export default function EntryPage() {
  const [form, setForm] = useState<FormValues>({
    childName: '',
    childFurigana: '',
    grade: '',
    parentName: '',
    email: '',
    phone: '',
    note: '',
  })

  // バリデーション用のエラーメッセージ（次のステップで使います）
  const [errors, setErrors] = useState<Partial<Record<keyof FormValues, string>>>({})

  const handleChange = (field: keyof FormValues, value: string) => {
    setForm((prev) => ({
      ...prev,
      [field]: value,
    }))
  }

  return (
    <div className="container mx-auto px-4 py-16">
      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-8 space-y-6">
        <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
          入会申込みフォーム
        </h1>
        <p className="text-gray-600">
          必要事項をご入力のうえ、「確認へ進む」ボタンを押してください。
        </p>

        <form className="space-y-4">
          <Input
            label="お子さまの氏名（必須）"
            name="childName"
            value={form.childName}
            onChange={(e) => handleChange('childName', e.target.value)}
            placeholder="山田 太郎"
            error={errors.childName}
          />

          <Input
            label="お子さまのフリガナ（必須）"
            name="childFurigana"
            value={form.childFurigana}
            onChange={(e) => handleChange('childFurigana', e.target.value)}
            placeholder="ヤマダ タロウ"
            error={errors.childFurigana}
          />

          {/* 学年（セレクトボックス） */}
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">
              学年（必須）
            </label>
            <select
              className={`
                block w-full rounded-md border px-3 py-2 shadow-sm
                focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
                ${errors.grade ? 'border-red-500' : 'border-gray-300'}
              `}
              value={form.grade}
              onChange={(e) => handleChange('grade', e.target.value)}
            >
              <option value="">選択してください</option>
              <option value="小1">小1</option>
              <option value="小2">小2</option>
              <option value="小3">小3</option>
              <option value="小4">小4</option>
              <option value="小5">小5</option>
              <option value="小6">小6</option>
            </select>
            {errors.grade && (
              <p className="text-xs text-red-500">{errors.grade}</p>
            )}
          </div>

          <Input
            label="保護者氏名"
            name="parentName"
            value={form.parentName}
            onChange={(e) => handleChange('parentName', e.target.value)}
            placeholder="山田 花子"
            error={errors.parentName}
          />

          <Input
            label="メールアドレス（必須）"
            name="email"
            type="email"
            value={form.email}
            onChange={(e) => handleChange('email', e.target.value)}
            placeholder="example@example.com"
            error={errors.email}
          />

          <Input
            label="電話番号（必須）"
            name="phone"
            value={form.phone}
            onChange={(e) => handleChange('phone', e.target.value)}
            placeholder="090-1234-5678"
            error={errors.phone}
          />

          {/* その他・ご質問など（テキストエリア） */}
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">
              その他・ご質問など（任意）
            </label>
            <textarea
              className="
                block w-full rounded-md border px-3 py-2 shadow-sm
                focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
                border-gray-300
              "
              rows={4}
              value={form.note}
              onChange={(e) => handleChange('note', e.target.value)}
              placeholder="ご希望の曜日やご質問などがあればご記入ください。"
            />
          </div>

          {/* ボタンはバリデーション実装後に動作を追加します */}
          <div className="pt-4">
            <Button type="submit" className="w-full">
              確認へ進む
            </Button>
          </div>
        </form>
      </div>
    </div>
  )
}
```

**現在の状態**: ✅ `/entry` で入会フォームの各入力欄が表示され、入力ができる（まだバリデーションはない）

---

## ✅ ステップ4: フォームバリデーション（必須チェック・形式チェック）の実装

このステップでは、**未入力や形式の間違いをチェックする処理** を追加します。  
ライブラリは使わず、まずはシンプルなロジックで実装します。

### 4-1. バリデーション関数を作る

`EntryPage` コンポーネント内に、次の関数を追加します：

```tsx
const validate = (values: FormValues) => {
  const newErrors: Partial<Record<keyof FormValues, string>> = {}

  if (!values.childName.trim()) {
    newErrors.childName = 'お子さまの氏名は必須です'
  }

  if (!values.childFurigana.trim()) {
    newErrors.childFurigana = 'フリガナは必須です'
  }

  if (!values.grade) {
    newErrors.grade = '学年を選択してください'
  }

  if (!values.email.trim()) {
    newErrors.email = 'メールアドレスは必須です'
  } else if (!values.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    newErrors.email = 'メールアドレスの形式が正しくありません'
  }

  if (!values.phone.trim()) {
    newErrors.phone = '電話番号は必須です'
  }

  return newErrors
}
```

### 4-2. フォーム送信時にバリデーションを実行する

`EntryPage` の `form` タグに `onSubmit` を追加し、次のように更新します：

```tsx
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault()

  const validationErrors = validate(form)
  setErrors(validationErrors)

  // エラーが1つもなければ、次のステップ（確認画面表示）に進む
  if (Object.keys(validationErrors).length === 0) {
    // ここで確認画面用の状態を更新します（ステップ5で実装）
  }
}
```

そして、`<form>` の部分を次のように変更します：

```tsx
<form className="space-y-4" onSubmit={handleSubmit}>
  {/* 各 Input や select, textarea はそのまま */}
</form>
```

**現在の状態**: ✅ 「確認へ進む」ボタンを押したとき、未入力や形式の誤りがあれば各項目の下にエラーメッセージが表示される

---

## ✅ ステップ5: 確認画面の実装（同じページ内で切り替え）

このステップでは、**入力フォームと確認画面を同じページの中で切り替える** 形で実装します。  
（ルーティングでページを分ける方法もありますが、まずはシンプルな構成にします）

### 5-1. 画面モード用の状態を追加

`EntryPage` の中で、次の state を追加します：

```tsx
const [isConfirmMode, setIsConfirmMode] = useState(false)
```

### 5-2. 送信処理（確認へ進む／戻る）の実装

`handleSubmit` を次のように更新します：

```tsx
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault()

  const validationErrors = validate(form)
  setErrors(validationErrors)

  if (Object.keys(validationErrors).length === 0) {
    // エラーがなければ確認画面に切り替え
    setIsConfirmMode(true)
  }
}
```

また、「戻る」ボタン用のハンドラも追加します：

```tsx
const handleBack = () => {
  setIsConfirmMode(false)
}
```

### 5-3. JSX を「入力モード」と「確認モード」で切り替える

`return` の中の `<form> ... </form>` 部分を、次のように書き換えます：

```tsx
{!isConfirmMode ? (
  // 入力フォームモード
  <form className="space-y-4" onSubmit={handleSubmit}>
    {/* ここにステップ3で作った各 Input / select / textarea をそのまま入れる */}

    <div className="pt-4">
      <Button type="submit" className="w-full">
        確認へ進む
      </Button>
    </div>
  </form>
) : (
  // 確認画面モード
  <div className="space-y-6">
    <div className="space-y-2">
      <h2 className="text-xl font-semibold text-gray-900">
        入力内容の確認
      </h2>
      <p className="text-gray-600 text-sm">
        以下の内容でよろしければ「この内容で申込む」を押してください。
        修正する場合は「入力に戻る」を押してください。
      </p>
    </div>

    <div className="space-y-4">
      <ConfirmRow label="お子さまの氏名" value={form.childName} />
      <ConfirmRow label="お子さまのフリガナ" value={form.childFurigana} />
      <ConfirmRow label="学年" value={form.grade} />
      <ConfirmRow label="保護者氏名" value={form.parentName || '（未入力）'} />
      <ConfirmRow label="メールアドレス" value={form.email} />
      <ConfirmRow label="電話番号" value={form.phone} />
      <ConfirmRow label="その他・ご質問など" value={form.note || '（未入力）'} />
    </div>

    <div className="flex flex-col md:flex-row gap-3 pt-4">
      <Button
        type="button"
        variant="secondary"
        className="w-full md:w-1/2"
        onClick={handleBack}
      >
        入力に戻る
      </Button>
      <Button
        type="button"
        className="w-full md:w-1/2"
        onClick={() => {
          // この日はまだ「画面だけ」の実装なので、送信処理はダミーにしておきます
          alert('この内容で申込み処理を行います（2/13 に実装予定）')
        }}
      >
        この内容で申込む
      </Button>
    </div>
  </div>
)}
```

あわせて、同じファイル内で次の小さなコンポーネントも定義しておくと、確認画面が書きやすくなります：

```tsx
type ConfirmRowProps = {
  label: string
  value: string
}

function ConfirmRow({ label, value }: ConfirmRowProps) {
  return (
    <div className="flex flex-col md:flex-row md:items-center md:gap-4 border-b border-gray-100 pb-3">
      <div className="w-full md:w-1/3 text-sm font-medium text-gray-600">
        {label}
      </div>
      <div className="w-full md:w-2/3 text-gray-900 whitespace-pre-wrap">
        {value}
      </div>
    </div>
  )
}
```

**現在の状態**: ✅ 正しく入力した場合に「確認画面」が表示され、内容を確認したり「入力に戻る」ことができる  
（「この内容で申込む」ボタンは、現時点ではアラート表示のみ）

---

## ✅ ステップ6: 動作確認

### 6-1. 開発サーバーの起動

1. ターミナルを開く  
2. 次のコマンドを実行：

```bash
cd frontend
npm run dev
```

3. `Local: http://localhost:3000` と表示されればOKです

---

### 6-2. 入会申込みフォームの確認

1. ブラウザで `http://localhost:3000/entry` にアクセス  
2. 画面の見た目を確認：
   - タイトル「入会申込みフォーム」が表示されている
   - 各入力欄（氏名・フリガナ・学年など）が表示されている
3. 何も入力せずに「確認へ進む」をクリック：
   - 必須項目にエラーメッセージが表示されることを確認
4. 正しい値を入力して「確認へ進む」をクリック：
   - 入力内容が一覧で表示される確認画面に切り替わることを確認
5. 「入力に戻る」をクリック：
   - 再度フォーム画面に戻り、入力した内容が残っていることを確認
6. 「この内容で申込む」をクリック：
   - アラートが表示されることを確認（保存処理はまだ実装しない）

---

## ✅ 完了チェックリスト

以下のチェックがすべて ✅ になれば、**「2/12（木）：入会手続き機能（1）」のメイン部分（画面実装）は完了**です。

- [ ] `/entry` ページが作成されている  
- [ ] 氏名・フリガナ・学年・連絡先などの入力欄が表示される  
- [ ] 必須項目のバリデーションが動作し、エラーメッセージが表示される  
- [ ] 入力内容を一覧で表示する確認画面に切り替えられる  
- [ ] 確認画面からフォームへ戻ることができ、入力内容も保持されている  
- [ ] 「この内容で申込む」ボタンが反応し（現時点ではアラートのみ）、次回以降の保存処理に備えられている  

---

## 📝 次のステップ

次回（2/13）の作業内容（入会手続き機能（2））では：

- 今日作成した入会申込みフォームからのデータを  
  **Supabase のデータベースに保存する処理** を実装する  
- 申込み完了画面の作成  
- 管理者側の入会管理用ページ（一覧・詳細）の土台づくり  

を行う予定です。  
詳細は `開発スケジュール.md` と、今後作成する **「実装手順6（入会手続き機能（2）」相当のドキュメント）** をあわせて確認してください。

---

## ⚠️ トラブルシューティング

### エラー1: `/entry` にアクセスすると 404 になる

**原因の例**:

- `frontend/app/entry/page.tsx` のパスやファイル名が間違っている  
- 開発サーバーを再起動していない

**解決方法**:

1. ファイルパスを再確認：`frontend/app/entry/page.tsx` になっているか  
2. 一度ターミナルで `Ctrl + C` でサーバーを止めて、`npm run dev` で再起動する

---

### エラー2: 「useState is not defined」のエラーが出る

**原因**: `useState` を `react` からインポートしていない。

**解決方法**:

```tsx
import { useState } from 'react'
```

が `page.tsx` の先頭付近に書かれているか確認する。

---

### エラー3: フォーム送信時に画面がリロードされてしまう

**原因**: `handleSubmit` 内で `e.preventDefault()` を書き忘れている。

**解決方法**:

```tsx
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault()
  // ここからバリデーション処理
}
```

となっているか確認する。

---

### エラー4: バリデーションが効かない／エラーメッセージが表示されない

**チェックポイント**:

- `validate` 関数が `handleSubmit` の中で呼ばれているか  
- `setErrors(validationErrors)` を呼び出しているか  
- `Input` コンポーネントに `error={errors.○○}` を渡しているか  
- `grade`（学年）のセレクトボックス下で `errors.grade` を表示しているか

---

## 📞 参考リンク

- **React 公式ドキュメント（フォーム）**: `https://ja.react.dev/learn`  
- **Next.js App Router ドキュメント**: `https://nextjs.org/docs/app`  
- **Tailwind CSS フォームスタイル**: `https://tailwindcss.com/docs/forms`  

---

**最終更新**: 2026年2月12日  
**対象**: プログラミング初心者の方

